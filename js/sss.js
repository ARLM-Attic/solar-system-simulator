(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C=[].slice;a=function(){function a(){}return a.width=window.innerWidth,a.height=window.innerHeight,a.defaultRootSize=100,a.defaultNodeSize=10,a.requiredNodesToMerge=5,a.colors={meteor:{start:"#fff",end:"#666"},earthy:{start:"#0f0",end:"#310c0c"},sun:{start:"#a00",end:"#fa0"},watery:{start:"#007fff",end:"#006"}},a}(),x=null,y=null,g=null,k=0,q={y:a.height/2,x:a.width/2,size:a.defaultRootSize,type:"sun",fixed:!0,auto:!1,children:[]},s=function(a,b){return Math.random()*(b-a)+a},b=function(a,b,c){return null==b&&(b=1),null==c&&(c="meteor"),a.children.push(n(a,b,c))},n=function(b,c,d){return null==b&&(b={x:Math.random()*a.width,y:Math.random*a.height}),null==c&&(c=1),null==d&&(d="meteor"),{type:d,children:[],size:c,id:++k,x:s(b.x-50,b.x+50),y:s(b.y-50,b.y+50),auto:"watery"===d?!0:!1}},u=[q],t=[],j=function(){return u.concat(t)},d=function(){return y.selectAll(".link")},e=function(){return y.selectAll(".node")},A=0,z=function(){var a;return d().attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}),e().attr("transform",function(a){return"translate("+a.x+","+a.y+")"}),A++>100?(A=0,a=f(),_.each(_.filter(a,function(a){return a.auto}),function(a){return i(a)})):void 0},l=function(){return g=d3.layout.force().linkDistance(150).charge(function(a){return"sun"===a.type?-1e3:-150}).chargeDistance(500).gravity(.03).friction(.9).linkStrength(.7).size([a.width,a.height]).on("tick",z)},f=function(){var a,b;return a=[],b=function(c){return a.push(c),c.id||(c.id=++k),c.children?_.each(c.children,b):void 0},_.each(j(),b),a},v=function(a){var b,c,d,e,f;for(e=a.children,f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(t.push(b));return f},i=function(a){return b(a),B(a),"sun"===a.type&&(a.size--,0===a.size&&(u=_.without(u,a),v(a))),h()},p=function(a){var b;if(0!==a.size&&"meteor"!==(b=a.type))return i(a)},r=function(a){return 0===a.children.length?a.size:a.size+_.reduce(a.children,function(a,b){return a+r(b)},0)},B=function(c){var d,e,f,g,h,i,j,k;for(i=[],e=f=0;3>f;e=++f)d=_.groupBy(c.children,function(a){return a.type}),i.push(function(){var e;e=[];for(k in d)h=d[k],h.length<a.requiredNodesToMerge||(c.children=_.without.apply(_,[c.children].concat(C.call(h))),j=_.reduce(h,function(a,b){return a+r(b)},0),g=o(k),"sun"===g?e.push(u.push(n(null,j,g))):e.push(b(c,j,g)));return e}());return i},o=function(a){switch(a){case"meteor":return"watery";case"watery":return"earthy";case"earthy":return"sun"}},h=function(){var b,c,h,i,j,k;return k=f(),h=d3.layout.tree().links(k),g.nodes(k).links(h).start(),x.select("defs").selectAll("*").remove(),c=x.select("defs").selectAll("radialGradient").data(k).enter().append("radialGradient").attr("gradientUnits","objectBoundingBox").attr("cx",0).attr("cy",0).attr("r","100%").attr("id",function(a){return"gradient-"+a.id}),c.append("stop").attr("offset","0%").style("stop-color",function(b){return a.colors[b.type].start}),c.append("stop").attr("offset","100%").style("stop-color",function(b){return a.colors[b.type].end}),h=d().data(h,function(a){return a.target.id}),h.exit().remove(),h.enter().insert("line",".node").attr("class","link"),k=e().data(k,function(a){return a.id}),k.exit().remove(),i=function(b){return Math.max(a.defaultNodeSize,b.size)},j=function(a){return a.size},b=k.enter().append("g").attr("class","node").on("click",p).call(g.drag),b.append("circle").attr("r",i),b.append("text").attr("dy",".35em").attr("fill","#fff").attr("text-anchor","middle").text(j),k.select("circle").style("fill",function(a){return"url(#gradient-"+a.id+")"}).attr("r",i),k.select("text").text(j)},w=function(){return h()},m=function(){var b,c;return c=function(){return y.attr("transform","scale("+d3.event.scale+")")},b=d3.behavior.zoom().scaleExtent([0,10]).on("zoom",c),x=d3.select("body").append("svg").attr("width",a.width).attr("height",a.height).attr("viewBox","0 0 "+a.width+" "+a.height).attr("preserveAspectRatio","xMidYMid meet").attr("pointer-events","all"),y=x.append("g").call(b).on("dblclick.zoom",null),x.append("defs")},c=function(){return d3.select(window).on("resize",function(){return x.attr("width",window.innerWidth).attr("height",window.innerHeight)})},m(),l(),c(),w()}).call(this);